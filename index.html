  <!DOCTYPE html>
  <html lang="ar" dir="rtl">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ğŸ•‹ØªØ·Ø¨ÙŠÙ‚ ØªÙˆØ«ÙŠÙ‚ Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø¬</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
      <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
      <style>
          :root {
              --primary-color: #D4AF37;
              --secondary-color: #E6C460;
              --light-color: #FFFFFF;
              --dark-color: #1A1A1A;
              --gold-color: #D4AF37;
              --danger-color: #dc3545;
          }

          .form-control::placeholder {
              color: rgba(255, 255, 255, 0.7) !important;
          }

          body {
              font-family: 'Amiri', system-ui, -apple-system, sans-serif;
              background: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1)),
                          url('https://images.unsplash.com/photo-1565552645632-d725f8bfc19a?w=1200');
              background-attachment: fixed;
              background-size: cover;
              background-position: center;
              color: var(--light-color);
              min-height: 100vh;
              padding: 2rem 0;
          }

          .container {
              max-width: 800px;
              background: rgba(0, 0, 0, 0.2);
              border-radius: 20px;
              box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
              padding: 2rem;
              position: relative;
              backdrop-filter: blur(8px);
              border: 1px solid rgba(255, 255, 255, 0.2);
          }

          .islamic-header {
              text-align: center;
              padding: 2rem 1rem;
              margin-bottom: 2rem;
              border-bottom: 2px solid var(--gold-color);
              position: relative;
              background: rgba(0, 0, 0, 0.15);
              border-radius: 15px 15px 0 0;
              backdrop-filter: blur(4px);
          }

          .islamic-header::before,
          .islamic-header::after {
              content: "â˜ª";
              color: var(--gold-color);
              position: absolute;
              top: 50%;
              transform: translateY(-50%);
              font-size: 1.5rem;
          }

          .islamic-header::before { right: 1rem; }
          .islamic-header::after { left: 1rem; }

          .bismillah {
              font-size: 2rem;
              color: var(--gold-color);
              text-align: center;
              margin-bottom: 1.5rem;
              text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
          }

          .dua-text {
              color: var(--light-color);
              font-size: 1.2rem;
              text-align: center;
              margin-top: 1rem;
              line-height: 1.8;
              display: flex;
              flex-direction: column;
              align-items: center;
              gap: 1.5rem;
          }

          .dua-line {
              text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
              position: relative;
              padding: 0 1rem;
          }

          .dua-line:not(:last-child)::after {
              content: "â";
              position: absolute;
              bottom: -1.2rem;
              left: 50%;
              transform: translateX(-50%);
              color: var(--gold-color);
              font-size: 0.8rem;
              opacity: 0.8;
          }

          .activity-card {
              background: rgba(0, 0, 0, 0.15);
              border-radius: 15px;
              padding: 1.5rem;
              margin-bottom: 1rem;
              box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
              border: 1px solid rgba(255, 255, 255, 0.2);
              transition: transform 0.3s, box-shadow 0.3s;
              backdrop-filter: blur(4px);
              position: relative;
          }

          .activity-card:hover {
              transform: translateY(-3px);
              box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
          }

          .delete-btn {
              background: rgba(220, 53, 69, 0.15);
              border: 1px solid rgba(220, 53, 69, 0.3);
              color: #ff8888;
              padding: 0.3rem 0.8rem;
              border-radius: 8px;
              font-size: 0.9rem;
              transition: all 0.3s ease;
              position: absolute;
              left: 1rem;
              top: 1rem;
          }

          .delete-btn:hover {
              background: rgba(220, 53, 69, 0.3);
              color: #ffffff;
          }

          .dua-modal {
              display: none;
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              background: rgba(0, 0, 0, 0.15);
              backdrop-filter: blur(12px);
              padding: 2rem;
              border-radius: 20px;
              box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
              border: 1px solid rgba(255, 255, 255, 0.2);
              z-index: 1000;
              max-width: 90%;
              width: 400px;
              animation: modalFadeIn 0.5s ease-out;
          }

          .dua-modal-overlay {
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background: rgba(0, 0, 0, 0.3);
              backdrop-filter: blur(4px);
              z-index: 999;
              animation: overlayFadeIn 0.5s ease-out;
          }

          .dua-message {
              font-size: 1.5rem;
              color: var(--gold-color);
              text-align: center;
              margin-bottom: 1.5rem;
              line-height: 1.6;
              font-family: 'Amiri', serif;
          }

          .dua-icon {
              text-align: center;
              font-size: 2.5rem;
              margin-bottom: 1rem;
              color: var(--gold-color);
              text-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
          }

          .close-modal {
              background: rgba(212, 175, 55, 0.2);
              border: 1px solid var(--gold-color);
              color: var(--light-color);
              padding: 0.5rem 2rem;
              border-radius: 10px;
              cursor: pointer;
              display: block;
              margin: 0 auto;
              transition: all 0.3s ease;
          }

          .close-modal:hover {
              background: var(--gold-color);
              color: var(--dark-color);
          }

          .btn-primary {
              background-color: var(--gold-color);
              border-color: var(--gold-color);
              color: var(--dark-color);
          }

          .btn-primary:hover {
              background-color: #C19B2C;
              border-color: #C19B2C;
          }

          .form-control {
              background: rgba(0, 0, 0, 0.15);
              border: 1px solid rgba(255, 255, 255, 0.2);
              color: var(--light-color);
              backdrop-filter: blur(4px);
          }

          .form-control:focus {
              background: rgba(0, 0, 0, 0.25);
              border-color: var(--gold-color);
              color: var(--light-color);
          }

          @keyframes modalFadeIn {
              from {
                  opacity: 0;
                  transform: translate(-50%, -60%);
              }
              to {
                  opacity: 1;
                  transform: translate(-50%, -50%);
              }
          }

          @keyframes overlayFadeIn {
              from {
                  opacity: 0;
              }
              to {
                  opacity: 1;
              }
          }
      </style>
  </head>
  <body>
      <div class="container">
          <div class="bismillah">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
          
          <header class="islamic-header">
              <h1 class="h3 mb-0">Ø³Ø¬Ù„ Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø¬ Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ</h1>
              <div class="dua-text">
                  <span class="dua-line">Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø§Ø¬Ù’Ø¹ÙÙ„Ù’Ù‡Ù Ø­ÙØ¬Ù‹Ù‘Ø§ Ù…ÙØ¨Ù’Ø±ÙÙˆØ±Ù‹Ø§</span>
                  <span class="dua-line">ÙˆÙØ³ÙØ¹Ù’ÙŠÙ‹Ø§ Ù…ÙØ´Ù’ÙƒÙÙˆØ±Ù‹Ø§</span>
                  <span class="dua-line">ÙˆÙØ°ÙÙ†Ù’Ø¨Ù‹Ø§ Ù…ÙØºÙ’ÙÙÙˆØ±Ù‹Ø§</span>
              </div>
          </header>

          <div class="mb-4">
              <h2 class="h5">ØªØ³Ø¬ÙŠÙ„ Ù†Ø´Ø§Ø· Ø¬Ø¯ÙŠØ¯</h2>
              <textarea 
                  id="activityInput" 
                  class="form-control mb-3" 
                  rows="4" 
                  placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙ Ù†Ø´Ø§Ø·Ùƒ Ù‡Ù†Ø§..."
                  onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); saveActivity(); }"></textarea>
              
              <div class="d-flex gap-2">
                  <button onclick="saveActivity()" id="saveButton" class="btn btn-primary flex-grow-1">
                      Ø­ÙØ¸ Ø§Ù„Ù†Ø´Ø§Ø·
                  </button>
                  <button onclick="exportToExcel()" id="exportButton" class="btn btn-success">
                      ØªØµØ¯ÙŠØ± Excel
                  </button>
              </div>
          </div>

          <div id="errorAlert" class="alert alert-danger d-none" role="alert"></div>
          <div id="successAlert" class="alert alert-success d-none" role="alert"></div>

          <div class="mt-4">
              <h3 class="h5">Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
              <div id="activitiesList" class="activities-container"></div>
          </div>
      </div>

      <!-- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ø¯Ø¹Ø§Ø¡ -->
      <div class="dua-modal-overlay" id="duaOverlay"></div>
      <div class="dua-modal" id="duaModal">
          <div class="dua-icon">ğŸ¤²</div>
          <div class="dua-message" id="duaMessage"></div>
          <button class="close-modal" onclick="closeDuaModal()">Ø¢Ù…ÙŠÙ†</button>
      </div>

      <script>
          let activities = JSON.parse(localStorage.getItem('hajjActivities') || '[]');

          const duas = [
              "Ù„Ø§ ØªÙ†Ø³Ø§Ù†ÙŠ Ù…Ù† Ø¯Ø¹Ø§Ø¦Ùƒ",
              "Ø§Ø¯Ø¹ Ù„ÙŠ Ø¨Ø§Ù„Ù‚Ø¨ÙˆÙ„",
              "Ø¯Ø¹ÙˆØ© ØµØ§Ø¯Ù‚Ø© Ù„Ø§ ØªÙ†Ø³Ø§Ù†ÙŠ",
              "ØªÙƒÙÙ‰ Ø§Ø¯Ø¹ Ù„ÙŠ Ø¨Ø§Ù„Ø®ÙŠØ±",
              "Ø§Ø°ÙƒØ±Ù†ÙŠ Ø¨Ø¯Ø¹ÙˆØ© Ø·ÙŠØ¨Ø©",
              "Ø§Ø¯Ø¹ÙŠ Ù„ÙŠ Ø¨Ø§Ù„Ø³Ù„Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ",
              "Ø§Ø¯Ø¹ Ù„ÙŠ Ø¨Ø§Ù„Ø¹ÙÙˆ Ùˆ Ø§Ù„Ø¹Ø§ÙÙŠÙ‡",
              "Ø§Ø¯Ø¹ Ù„ÙŠ Ø¨Ø§Ù„ÙØ±Ø¯ÙˆØ³ Ø§Ù„Ø£Ø¹Ù„Ù‰",
              "Ø§Ø¯Ø¹ÙŠ Ù„ÙˆØ§Ù„Ø¯ÙŠ Ø¨Ø§Ù„ØµØ­Ø© Ùˆ Ø§Ù„Ø¹Ø§ÙÙŠØ©",
              "Ùˆ Ù„Ùƒ Ø¨Ù…Ø«Ù„ ÙƒÙ„ Ù…Ø§Ø¯Ø¹ÙŠØª Ù„ÙŠ"
          ];

          function showDuaModal() {
              const randomDua = duas[Math.floor(Math.random() * duas.length)];
              document.getElementById('duaMessage').textContent = randomDua;
              document.getElementById('duaOverlay').style.display = 'block';
              document.getElementById('duaModal').style.display = 'block';
              document.body.style.overflow = 'hidden';
          }

          function closeDuaModal() {
              document.getElementById('duaOverlay').style.display = 'none';
              document.getElementById('duaModal').style.display = 'none';
              document.body.style.overflow = 'auto';
          }

          function deleteActivity(id) {
              if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù†Ø´Ø§Ø·ØŸ')) {
                  activities = activities.filter(activity => activity.id !== id);
                  localStorage.setItem('hajjActivities', JSON.stringify(activities));
                  displayActivities();
                  showMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†Ø´Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­', 'success');
              }
          }

          function formatDate(date) {
              return new Date(date).toLocaleString('ar-SA', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                  hour: '2-digit',
                  minute: '2-digit',
                  hour12: true
              });
          }

          function showMessage(message, type = 'error') {
              const alertElement = document.getElementById(type === 'error' ? 'errorAlert' : 'successAlert');
              alertElement.textContent = message;
              alertElement.classList.remove('d-none');
              setTimeout(() => alertElement.classList.add('d-none'), 5000);
          }

          function displayActivities() {
              const container = document.getElementById('activitiesList');
              if (activities.length === 0) {
                  container.innerHTML = '<div class="text-center text-muted p-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ø´Ø·Ø© Ù…Ø³Ø¬Ù„Ø©</div>';
                  return;
              }
              container.innerHTML = activities.map(activity => `
                  <div class="activity-card">
                      <button onclick="deleteActivity('${activity.id}')" class="delete-btn">
                          Ø­Ø°Ù Ø§Ù„Ù†Ø´Ø§Ø·
                      </button>
                      <div class="timestamp mb-2">
                          ${formatDate(activity.timestamp)}
                      </div>
                      <div class="mb-2">
                          ${activity.text}
                      </div>
                      ${activity.location ? `
                          <div class="location-text">
                              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                  <circle cx="12" cy="10" r="3"></circle>
                              </svg>
                              ${activity.location.address || `${activity.location.lat}, ${activity.location.lng}`}
                          </div>
                      ` : ''}
                  </div>
              `).join('');
          }

          async function saveActivity() {
              const activityText = document.getElementById('activityInput').value.trim();
              
              if (!activityText) {
                  showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙˆØµÙ Ø§Ù„Ù†Ø´Ø§Ø·');
                  return;
              }

              try {
                  const position = await new Promise((resolve, reject) => {
                      navigator.geolocation.getCurrentPosition(resolve, reject, {
                          enableHighAccuracy: true,
                          timeout: 10000,
                          maximumAge: 0
                      });
                  });

                  const newActivity = {
                      id: Date.now().toString(),
                      text: activityText,
                      timestamp: new Date().toISOString(),
                      location: {
                          lat: position.coords.latitude,
                          lng: position.coords.longitude
                      }
                  };

                  try {
                      const response = await fetch(
                          `https://nominatim.openstreetmap.org/reverse?lat=${position.coords.latitude}&lon=${position.coords.longitude}&format=json`
                      );
                      const data = await response.json();
                      newActivity.location.address = data.display_name;
                  } catch (err) {
                      console.log('ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†');
                  }

                  activities.unshift(newActivity);
                  localStorage.setItem('hajjActivities', JSON.stringify(activities));
                  document.getElementById('activityInput').value = '';
                  displayActivities();
                  showMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†Ø´Ø§Ø· Ø¨Ù†Ø¬Ø§Ø­', 'success');
                  
                  setTimeout(showDuaModal, 1000);

              } catch (err) {
                  showMessage('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹.');
              }
          }

          function exportToExcel() {
              if (activities.length === 0) {
                  showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ø´Ø·Ø© Ù„Ù„ØªØµØ¯ÙŠØ±');
                  return;
              }

              try {
                  const workbookData = activities.map(activity => ({
                      'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª': formatDate(activity.timestamp),
                      'Ø§Ù„Ù†Ø´Ø§Ø·': activity.text,
                      'Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶': activity.location?.lat || '',
                      'Ø®Ø· Ø§Ù„Ø·ÙˆÙ„': activity.location?.lng || '',
                      'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': activity.location?.address || ''
                  }));

                  const worksheet = XLSX.utils.json_to_sheet(workbookData);
                  const workbook = XLSX.utils.book_new();
                  XLSX.utils.book_append_sheet(workbook, worksheet, 'Ø§Ù„Ø£Ù†Ø´Ø·Ø©');

                  XLSX.writeFile(workbook, `Ø§Ù†Ø´Ø·Ø©_Ø§Ù„Ø­Ø¬_${new Date().toLocaleDateString('ar-SA')}.xlsx`);
                  showMessage('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
              } catch (error) {
                  showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„Ù');
              }
          }

          displayActivities();
      </script>
  </body>
  </html>
